{% extends 'base.html' %}
{% load restructuredtext_filter staticfiles %}

{% block head %}
	<title>StackSmash - Posts</title>
	<link type="text/css" href="{% static 'posts.css' %}" rel="stylesheet">
{% endblock %}

{% block body %}
	<div class="sidebar">
		{% if request.user.is_staff %}
			<p>Staff Options</p>
			<hr />
			<a href="/admin/blog/post/add/">New Post</a><br />
			<a href="/upload/">Upload a file</a>
		{% endif %}
		<p>Archives</p>
		<hr />
		{% for month in months %}
			{% ifchanged month.0 %} {{ month.0 }} <br /> {% endifchanged %}
			<a href="{% url 'blog:archive' month.0 month.1 %}" id="month">{{ month.2 }}</a><br />
		{% endfor %}
	</div>
	<div class="posts">
	{% if not posts %}
		<center><h2>Sorry. No posts found :(</h2></center>
	{% endif %}
	{% for post in posts %}
		<div class="pre-post">
			<a href="{{ post.get_absolute_url|escape }}" id="title">{{post.title}}</a>
			<div class="post-date">{{ post.pub_date }} by <b>{{post.posted_by}}</b> | <a href="{{ post.get_absolute_url|escape }}#comments">{{ post.comment_set.count }} comments</a></div>
		</div>
		<hr />
		<div class="post">{{ post.content|restructuredtextify:post|truncatewords_html:60 }}</div>
	{% endfor %}
	</div>


	{% if not archive and posts.object_list and posts.paginator.num_pages > 1 %}
		<!-- pagination -->
		<div class="pagination">
			{% if posts.has_previous %}
			 <a href= "?page={{ posts.previous_page_number }}">newer entries &lt;&lt; </a>
			{% endif %}

			<span class="current">
			    &nbsp;Page {{ posts.number }} of {{ posts.paginator.num_pages }}
			</span>

			{% if posts.has_next %}
			 <a href="?page={{ posts.next_page_number }}"> &gt;&gt; older entries</a>
			{% endif %}
		</div>
	{% endif %}
{% endblock %}

